<!DOCTYPE html>
<html>

<head>
    <title>Chat Widget | Quint Lab</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
    <!-- Fontawesome CSS -->
    <link href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" rel="stylesheet">
    <!-- Colorpicker CSS -->
    <link rel="stylesheet" media="screen" type="text/css" href="assets/css/colorpicker.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/form.css">
    <link rel="stylesheet" type="text/css" href="assets/css/index.css">
    <link rel="stylesheet" type="text/css" href="assets/css/switchWidgetPage.css">
    <link rel="stylesheet" href="assets/css/chat.css">
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark"> <a href="#" class="navbar-brand mb-0 h1"> <img src="assets/images/qLabLogo.png" alt="" width="100" height="100%" class="d-inline-block align-top"> </a>
    </nav>
    <div class="container" id="main-content">
        <nav aria-label="breadcrumb" role="navigation" id="breadcrumbSection">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Widgets</li>
            </ol>
        </nav>
        <div class="row">
            <div class="col-lg-12">
                <h2 class="display-4">Chat</h2>
                <hr>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-5 col-sm-12" align="center">
                <h4 class="display-4">Build Chat</h4>
            </div>
            <div class="col-lg-7 col-sm-12" align="center">
                <h4 class="display-4"> Preview </h4>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 col-sm-12">
                <div class="inner-block">
                    <ul id="ProfileDetails">
                        <li>
                            <figure>
                                <div class="profile-img"><img alt="" src="assets/images/avatar.svg"></div>
                                <figcaption>
                                    <input type="text" name="Profile Name" class="form-control name" placeholder="Enter Profile Name">
                                    <input type="text" name="Profile Image" class="form-control url" placeholder="Enter Image Url">
                                </figcaption>
                            </figure>
                        </li>
                        <li>
                            <figure>
                                <div class="profile-img"><img alt="" src="assets/images/avatar.svg"></div>
                                <figcaption>
                                    <input type="text" name="Profile Name" class="form-control name" placeholder="Enter Profile Name">
                                    <input type="text" name="Profile Image" class="form-control url" placeholder="Enter Image Url">
                                </figcaption>
                            </figure>
                        </li>
                    </ul>
                    <div class="btn-area"> <a href="javascript:void(0);" class="btn-custom" id="BtnAddProfile"><i class="fa fa-plus"></i> Add Profile</a> </div>
                </div>
                <div class="inner-block">
                    <ul id="ProfileList" class="clearfix">
                        <li>
                            <a href="javascript:void(0);">
                                <figure>
                                    <div class="profile-img"><img alt="" src="assets/images/avatar.svg"></div>
                                    <figcaption class="profle-des"></figcaption>
                                </figure>
                            </a>
                        </li>
                        <li>
                            <a href="javascript:void(0);">
                                <figure>
                                    <div class="profile-img"><img alt="" src="assets/images/avatar.svg"></div>
                                    <figcaption class="profle-des"></figcaption>
                                </figure>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="message-bulder-section inner-block">
                    <ul class="dynamic-list" id="MessageBulder">
                    </ul>
                </div>
            </div>
            <div class="col-lg-6 col-sm-12">
                <div class="btn-area clearfix"> <a href="javascript:void(0);" style="float: left;" id="BtnPreview" class="btn-custom">Lets Preview Discusson</a> <i style="position: absolute; top: 11px; left: 190px; display: none;" class="fas fa-spin fa-sync-alt ml-1 refresh-icon"></i>
                    <form id="foo" style="display: inline;">
                        <textarea style="width: 100%; display: none; border: 1px solid #dadada; margin: 30px 0;" id="message" name="message" rows="5"></textarea>
                        <button type="submit" style="float: left; margin-left: 10px; display: none;" class="btn-custom create_conversation">Create Conversation</button>
                    </form>
                </div>
                <div class="inner-block iframe-url">
                    <label>Embed Code</label>
                    <textarea class="form-control"></textarea>
                </div>
                <div class="inner-block">
                    <ul class="dynamic-list" id="preview">
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <!-- Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>
    <!-- Twitter JS -->
    <!-- <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> -->
    <!-- Colorpicker JS -->
    <!--<script type="text/javascript" src="assets/js/colorpicker.js"></script> -->
    <!-- Custom JS -->
    <script type="text/javascript" src="assets/js/spreadsheet.js"></script>
    <script type="text/javascript" src="assets/js/chat-dashboard.js"></script>
    <script type="text/javascript" src="assets/js/chat.js"></script>
    <script>
    var public_spreadsheet = 'https://docs.google.com/spreadsheets/d/1_eWCuXCI-GavXYEAp_KCUcsWWeDDjpLGCGZ100-pY0M/pubhtml';

    // Variable to hold request
    var request;

    // Bind to the submit event of our form
    $("#foo").submit(function(event) {

        event.preventDefault();
        if (validation()) {

            $(this).hide();
            $('.refresh-icon').show();

            update_preview();
            // Abort any pending request
            if (request) {
                request.abort();
            }
            // setup some local variables
            var $form = $(this);

            // Let's select and cache all the fields
            var $inputs = $form.find("input, select, button, textarea");

            // Serialize the data in the form
            var serializedData = $form.serialize();

            // Let's disable the inputs for the duration of the Ajax request.
            // Note: we disable elements AFTER the form data has been serialized.
            // Disabled form elements will not be serialized.
            $inputs.prop("disabled", true);

            Tabletop.init({
                key: public_spreadsheet,
                callback: showInfo,
                simpleSheet: true
            });


            function showInfo(data) {

                // Fire off the request to /form.php
                request = $.ajax({
                    url: "https://script.google.com/macros/s/AKfycbwLO1_KiofeE3T26Yt8OFMpoOihSxync_mdJde2QjxLyEGCxOQ4/exec",
                    type: "post",
                    data: serializedData
                });

                // Callback handler that will be called on success
                request.done(function(response, textStatus, jqXHR) {
                    // Log a message to the console
                    console.log("Hooray, it worked!");
                    console.log(response);
                    console.log(textStatus);
                    console.log(jqXHR);
                    $('.create_conversation, #foo').show();
                    $('.refresh-icon').hide();

                });

                // Callback handler that will be called on failure
                request.fail(function(jqXHR, textStatus, errorThrown) {
                    // Log the error to the console
                    console.error(
                        "The following error occurred: " +
                        textStatus, errorThrown
                    );
                });

                // Callback handler that will be called regardless
                // if the request failed or succeeded
                request.always(function() {
                    // Reenable the inputs
                    $inputs.prop("disabled", false);
                });

                // Prevent default posting of form
                event.preventDefault();

                var str = "<iframe src='https://www.thequint.com/quintlab/dashboard/twitter/index.html?id=" + parseInt(data.length + 2) + "' width='100%' frameborder='0'></iframe>";

                $('.iframe-url').show();
                $('.iframe-url textarea').val(str);

            }
        }
    });
    </script>
</body>

</html>