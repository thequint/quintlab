<!DOCTYPE html>
<html lang="en">

<head>
<title>Quiz Widget | Quint Lab</title>
<meta charset="utf-8">
<!-- <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<!-- Bootstrap CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
<link href="https://use.fontawesome.com/releases/v5.0.4/css/all.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="assets/css/index.css">
<link rel="stylesheet" type="text/css" href="assets/css/switchWidgetPage.css">
<link rel="stylesheet" type="text/css" href="assets/css/quiz.css">
<!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/meyer-reset/2.0/reset.css" rel="stylesheet">
<link href="quizzes/assets/css/check-radio.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="quizzes/assets/css/styles.css"> -->

<link rel="stylesheet" type="text/css" href="poll/assets/css/poll.css">

</head>


<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a href="#" class="navbar-brand mb-0 h1">
			<img src="assets/images/tquint-white.svg" width="100" height="100%" class="d-inline-block align-top">
		</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="navbar-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						Your Account
					</a>
                    <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <a href="#" class="dropdown-item">View</a>
                        <a href="#" class="dropdown-item">Edit</a>
                        <a href="#" class="dropdown-item">Some Action</a>
                        <a href="#" class="dropdown-item">Another Action</a>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link">Logout</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container" id="main-content">
        <nav aria-label="breadcrumb" role="navigation" id="breadcrumbSection">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Widgets</li>
            </ol>
        </nav>
        <div class="row generate-quiz">
            <div class="display-4 col-sm-6">
                <h2 class="display-4">Poll</h2></div>
            <!-- <div class="display-4 col-sm-6 text-right">
                <form id="foo">
                    <textarea id="Comments" name="Comments" cols="40" placeholder="Your Message" autocomplete="off" style="visibility:hidden;display:none"></textarea>
                    <button type="submit" class="btn btn-primary generate-quiz-button">Generate Quiz</button>
                </form>
            </div> -->
        </div>
        <div class="row">
           

            <div class="draggable-wrap">
                <button class="create-poll-btn">Create Poll</button>
                <button class="preview-poll-btn">Preview Poll</button>

                <div class="preview-poll" style="display:none">preview</div>

                <div class="create-poll">
                    <div class="drag-inputs">
                        <form>
                            <input class="upload_input" type="text" placeholder="Upload Image">
                            <button class="upload_btn">Upload</button>
                        </form>
                    </div>

                    <div class="drag-container resize-container">
                        <div class="image-editor">
                            <!-- <input type="file" class="cropit-image-input"> contenteditable="true"-->
                            <div class="drag-preview">
                                <div class="cropit-preview"></div>
                                <div class="drag-content resize-drag">
                                    <div class="drag-question"><span id="question_txt" class="makeEditable">Ask a Question...</span></div>
                                    <div class="drag-answer">
                                        <div class="drag-answer--left"><span id="answer_right" class="makeEditable">Yes</span></div>
                                        <div class="drag-answer--right"><span id="answer_wrong" class="makeEditable">No</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="controls-wrapper">
                                <div class="rotation-btns">
                                    <!-- <span class="icon icon-rotate-left rotate-ccw-btn"></span>
                                    <span class="icon icon-rotate-right rotate-cw-btn"></span> -->
                                    <button class="rotate-ccw"><i class="fa fa-undo-alt"></i></button>
                                    <button class="rotate-cw"><i class="fa fa-redo-alt"></i></button>
                                </div>
                                <div class="slider-wrapper">
                                    <span class="icon icon-image small-image"><i class="fa fa-image"></i></span>
                                    <input type="range" class="cropit-image-zoom-input custom" min="0" max="1" step="0.01"><span class="icon icon-image large-image"><i class="fa fa-image"></i></span>
                                </div>
                                <!-- <div class="export-wrapper">
                                    <button class="export">Export</button>
                                </div> -->
                            </div>
                        </div>
                        <div class="drag-btns">
                            <form id="foo">
                                <button type="submit" class="drag-submit">Submit</button>
                                <textarea id="pollSheetData" name="pollSheetData" cols="40" placeholder="Your Message" style="display:none"></textarea>
                            </form>
                            <div class="embedded-code"></div>
                            <!-- <span class="btn-prev">Prev</span>
                            <span class="btn-next">Next</span> -->
                        </div>
                    </div>
                </div>



            </div>
        </div>
       
    </div>


<!-- <div class="image-editor">
    <input type="file" class="cropit-image-input">
    <div class="cropit-preview"></div>
    <div class="image-size-label">
        Resize image
    </div>
    <input type="range" class="cropit-image-zoom-input">
    <button class="rotate-ccw">Rotate counterclockwise</button>
    <button class="rotate-cw">Rotate clockwise</button>
    <button class="export">Export</button>
</div> -->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="quizzes/assets/js/spreadsheet.js"></script>
<script src="https://fea.quintype.com/thequint/assets/iframeResizer.contentWindow.min_0bb6a81590ea182e4a7b799f4b6b4821.js"></script>

<script src="assets/js/jquery.cropit.js"></script>


<script type="text/javascript" src="http://code.interactjs.io/v1.3.3/interact.min.js"></script>

<script type="text/javascript">

    var public_spreadsheet_contact = 'https://docs.google.com/spreadsheets/d/1vDgiznBMahleOg-UdIStijlMiVr_29ijnbgNmNuGRrI/pubhtml'; // New form quiz sheet


    Tabletop.init({
        key: public_spreadsheet_contact,
        callback: showInfoPreview,
        simpleSheet: true
    });

    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }

    var poll_data_pull;

    function showInfoPreview(data) {

        console.log(data);

        console.log()

        /*
        console.log(data[getParameterByName('id')-2].pollSheetData);
        poll_data_pull = JSON.parse(data[getParameterByName('id')-2].pollSheetData);
        console.log(poll_data_pull);
        
        $(".cropit-preview-image").attr("src", poll_data_pull[0].imgURL);
        $(".cropit-preview-image").attr("style", poll_data_pull[0].imgTransform);
        $(".resize-drag").attr("style", poll_data_pull[0].resizeDrag);

        $("#question_txt").text(poll_data_pull[0].qusTxt);
        $("#answer_right").text(poll_data_pull[0].ansRight);
        $("#answer_wrong").text(poll_data_pull[0].ansWrong);
        $("#id").val(getParameterByName('id'));

        console.log(poll_data_pull[0].imgURL);
        console.log(poll_data_pull[0].imgTransform);
        console.log(poll_data_pull[0].resizeDrag);

        console.log(new Date(Date.parse(poll_data_pull[0].dateTime)).getHours());

        console.log(new Date().getHours()- new Date(Date.parse(poll_data_pull[0].dateTime)).getHours());
        if(new Date().getHours()- new Date(Date.parse(poll_data_pull[0].dateTime)).getHours()>1)
        {
             existValue() 
        }*/
    }

    //////////////////////////


    $(".create-poll-btn").click(function(){
        $(".create-poll").show();
        $(".preview-poll").hide();
    });

    $(".preview-poll-btn").click(function(){
        $(".create-poll").hide();
        $(".preview-poll").show();
    });



    // Upload BTN
    $(".upload_btn").click(function(e){
        e.preventDefault();

        if($(".upload_input").val()==""){
            alert("Please insert image URL")
        }else {
            var input_val = $(".upload_input").val();
            $(".cropit-preview-image").attr("src",input_val);
            $(".drag-content").fadeIn();
            $(".controls-wrapper").fadeIn();
            $(".drag-btns").fadeIn();
            reloadFunc();
        }
    });

    // reload data
    function reloadFunc(){
        $('.image-editor').cropit({
            imageState: {
                src: $(".upload_input").val(),
            },
        });
        $('.rotate-cw').click(function() {
            $('.image-editor').cropit('rotateCW');
        });
        $('.rotate-ccw').click(function() {
            $('.image-editor').cropit('rotateCCW');
        });

        $('.export').click(function() {
            var imageData = $('.image-editor').cropit('export');
            window.open(imageData);
        });
    }

    // editable
    $.fn.editable = function() {
        var textBlocks = $(this);

        // Create a new input for every div that is selected
        // .my-text-box class is added so we can attach events to this class :) there is other approaches too.
        for(var i = 0; i < textBlocks.length; i+=1){
            var textBox = $('<input class="my-text-box"/>');
            var textBlock = textBlocks.eq(i); textBox.hide().insertAfter(textBlock).val(textBlock.html());
        }

        // Hiding the div and showing a input to allow editing the value.
        textBlocks.dblclick(function() {
            toggleVisiblity($(this), true); // Pass the dbl clicked div element via $(this) 
        });

        // Hiding the input and showing the original div
        $('.my-text-box').blur(function() {
            toggleVisiblity($(this), false); // Pass the input that loses focus via $(this)
        });

        toggleVisiblity = function(element, editMode) {
            var textBlock, 
                textBox;

            if (editMode === true) {
                textBlock = element; // here the element is the div
                textBox = element.next(); // here element is the div so the textbox is next
                textBlock.hide();
                textBox.show().focus();
                // workaround, to move the cursor at the end in input box.
                textBox[0].value = textBox[0].value;
            } else {
                textBlock = element.prev(); // Here element is the input so the div is previous
                textBox = element; // here element is the textbox
                textBlock.show();
                textBox.hide();
                textBlock.html(textBox.val());
            }
        };
    };

    var $edit = $('.makeEditable').editable();



    // RESIZE BOX
    interact('.resize-drag')

    .draggable({
        onmove: window.dragMoveListener,
        restrict: {
            restriction: 'parent',
            elementRect: { top: 0, left: 0, bottom: 1, right: 1 }
        },
    })
    .resizable({
        // resize from all edges and corners
        edges: { left: true, right: true, bottom: true, top: true },

        // keep the edges inside the parent
        restrictEdges: {
            outer: 'parent',
            endOnly: true,
        },

        // minimum size
        restrictSize: {
            min: { width: 100, height: 50 },
        },

        inertia: true,
    })
    .on('resizemove', function(event) {
        var target = event.target,
            x = (parseFloat(target.getAttribute('data-x')) || 0),
            y = (parseFloat(target.getAttribute('data-y')) || 0);

        // update the element's style
        target.style.width = event.rect.width + 'px';
        target.style.height = event.rect.height + 'px';

        // translate when resizing from top or left edges
        x += event.deltaRect.left;
        y += event.deltaRect.top;

        target.style.webkitTransform = target.style.transform =
            'translate(' + x + 'px,' + y + 'px)';

        target.setAttribute('data-x', x);
        target.setAttribute('data-y', y);
     //   target.textContent = Math.round(event.rect.width) + '\u00D7' + Math.round(event.rect.height);
    });

    function dragMoveListener(event) {
        var target = event.target,
            // keep the dragged position in the data-x/data-y attributes
            x = (parseFloat(target.getAttribute('data-x')) || 0) + event.dx,
            y = (parseFloat(target.getAttribute('data-y')) || 0) + event.dy;

        // translate the element
        target.style.webkitTransform =
            target.style.transform =
            'translate(' + x + 'px, ' + y + 'px)';

        // update the posiion attributes
        target.setAttribute('data-x', x);
        target.setAttribute('data-y', y);
    }

    // this is used later in the resizing and gesture demos
    window.dragMoveListener = dragMoveListener;
</script>








<script>


    var poll_data_push = [];

    function arrayFunction() {
        poll_data_push.push({});
        poll_data_push[0]['imgURL'] = $(".upload_input").val();
        poll_data_push[0]['imgTransform'] = $(".cropit-preview-image").attr("style", );

        poll_data_push[0]['resizeDrag'] = $(".resize-drag").attr("style", );

        poll_data_push[0]['qusTxt'] = $("#question_txt").text();

        poll_data_push[0]['ansRight'] = $("#answer_right").text();
        poll_data_push[0]['ansWrong'] = $("#answer_wrong").text();


        poll_data_push[0]['dateTime'] =new Date().toString();
        
        console.log(poll_data_push);
    }

    function copyHandler() {
        $(".copy-val").click(function() {
            $(".embedded-iframe").select();
            document.execCommand('copy');
        });
    }

    var request;

 //   console.log(JSON.stringify(new Date().toString()));

    $("#foo").submit(function(event) {
        // console.log("init");		
        event.preventDefault();

        arrayFunction();
        //console.log(poll_data_push);

       // console.log(poll_data_push[0]['resizeDrag']);

        $("#pollSheetData").val(JSON.stringify(poll_data_push));
        console.log(JSON.stringify(poll_data_push));
        // add value to the textarea
        if (request) {
            request.abort();
        }
        // setup some local variables
        var $form = $(this);
        // let's select and cache all the fields
        var $inputs = $form.find("input, select, button, textarea");
        // serialize the data in the form
        var serializedData = $form.serialize();

        // Disabled form elements will not be serialized.
        $inputs.prop("disabled", true);
        $('#result').text('Sending data...');

        Tabletop.init({
            key: public_spreadsheet_contact,
            callback: showInfo,
            simpleSheet: true
        });


        function showInfo(data) {

            // alert('yes');
            // fire off the request to /form.php
            request = $.ajax({
                // url: "https://script.google.com/macros/s/AKfycbwiRwxDqkOK1A5S1bb5T993rnKL3kiUQOKgz3sjpen_oIgFiwAF/exec",
                url: "https://script.google.com/macros/s/AKfycbylYyMpYbrBsTBAu2gVXx6bQlnH6puxMIE3RLrnD36A6WOX4xNI/exec",
                type: "get",
                data: serializedData
            });

            // callback handler that will be called on success
            request.done(function(response, textStatus, jqXHR) {
                $('#result').html('<span class="success">Success</span>');
                console.log("Hooray, it worked!");
            });

            // callback handler that will be called on failure
            request.fail(function(jqXHR, textStatus, errorThrown) {
                // log the error to the console
                console.error(
                    "The following error occured: " +
                    textStatus, errorThrown
                );
            });

            // if the request failed or succeeded
            request.always(function() {
                // reenable the inputs
                $inputs.prop("disabled", false);
            });

            //$('#foo').find('input, textarea').val('');

            var str = "<iframe src='poll/index.html?id=" + parseInt(data.length + 2) + "' width='100%' frameborder='0'></iframe>";
            $('.embedded-code').prepend('<form><div class="form-group"><label for="text" class="embedded-label">Embedded Code</label><textarea type="text" rows="5" class="form-control embedded-iframe" placeholder="The link will be shown here...">' + str + '</textarea><span class="copy-val">Copy</span></div></form>');
            copyHandler();
        }
        // prevent default posting of form
         // event.preventDefault();
    });
</script>
</body>

</html>