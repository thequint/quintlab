<!DOCTYPE html>
<html lang="hi">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="format-detection" content="date=no">
    <meta name="format-detection" content="address=no">
    <meta name="format-detection" content="email=no">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="apple-mobile-web-app-title" content="">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fff" />
    <title>Yahoo Feed</title>
    <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    <meta name="Keywords" content="" />
    <meta name="author" content="Quint Lab">
    <meta name="copyright" content="The Quint">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,900">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.9.0/bootstrap-table.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.9/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="assets/css/base.css">
    <link rel="stylesheet" href="assets/css/theme.css">
    <link rel="stylesheet" href="assets/css/responsive.css">
    <style>
        .print_btn {
        cursor: pointer;
        }
        </style>


</head>

<body>
    <main class="wrapper main-wrapper">
        <header class="wrapper header-wrapper" id="header">
            <div class="container">
                <a class="logo-tq" target="_blank" href="https://www.thequint.com/"><img src="assets/images/logo-myreport-debate.svg" alt="TheQuint"></a>
                <a class="nav-bar" href="javascript:void(0);"><span>Menu</span></a>
                <nav class="top-nav">
                    <a class="close-nav" href="javascript:void(0);">Close</a>
                    <a class="logo-bottom" href="javascript:void(0);"><img src="assets/images/logo-myreport-debate-bottom.svg" alt=""></a>
                    <ul class="clearfix">
                        <!-- <li><a href="data-list-english.html">English</a></li>
                            <li><a href="data-list-hindi.html">हिंदी</a></li> -->
                        <li class="add"><a href="data-detail.html"><i class="fa fa-plus-square"></i> Add Feed</a></li>
                        <li><a class="des" href="#"><i class="fa fa-sign-out"></i> Logout</a></li>
                    </ul>
                </nav>
            </div>
        </header>
        <section class="wrapper banner-wrapper">
            <div class="container">
                <div class="controll clearfix">
                    <a href="data-list-english.html" class="back_link"><i class="fa fa-arrow-left"></i> Back</a>
                    <!-- <a class="print_btn"><i class="fa fa-print"></i> Print</a> -->
                </div>
                <div class="data-detail">
                    <div class="data-header">
                        <h2></h2>
                    </div>
                    <div class="data-body editable-form clearfix">
                        <form>
                            <div class="form-main">
                                
                                <div class="data-block" data-field="category">
                                    <h3>Category</h3>
                                    <div class="form-group">
                                        <div class="radios clearfix">
                                            <div class="single-radio">
                                                <input type="radio" id="Radio_tq" name="radio-group" value="TQ" checked>
                                                <label for="Radio_tq">TQ</label>
                                            </div>

                                            <div class="single-radio">
                                                <input type="radio" id="Radio_ipl" name="radio-group" value="IPL">
                                                <label for="Radio_ipl">IPL</label>
                                            </div>

                                            <div class="single-radio">
                                                <input type="radio" id="Radio_hq" name="radio-group" value="HQ">
                                                <label for="Radio_hq">HQ</label>
                                            </div>

                                            <div class="single-radio">
                                                <input type="radio" id="Radio_bq" name="radio-group" value="BQ">
                                                <label for="Radio_bq">BQ</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <h3>Enter ID</h3>
                                <div class="form-group">
                                    <div class="form-group-input"><input type="text" placeholder="Enter ID" id="enterId">
                                    </div>
                                    <div class="form-group-submit"><button class="btn btn-default" id="form_btn">Submit</button></div>
                                </div>
                            </div>
                        </form>

                        <form id="details_form" >
                            <div class="data-body-left">
                                <div class="data-block" data-field="title">
                                    <h3>Title</h3>
                                    <!-- <p></p> -->
                                    <div class="form-group">
                                        <input type="text" name="title" placeholder="Title" id="title_val">
                                    </div>
                                </div>
                                <div class="data-block" data-field="link">
                                    <h3>Link</h3>
                                    <div class="form-group">
                                        <input type="text" name="link" placeholder="Link" id="link_val">
                                    </div>
                                </div>
                                <div class="data-block date-field" data-field="date">
                                    <h3>Date</h3>
                                    <p></p>
                                    <div class="form-group">
                                        <input type="date" name="date" value="2017-06-01" id="date">
                                    </div>
                                </div>
                                <div class="data-block" data-field="description">
                                    <h3>Description</h3>
                                    <div class="form-group">
                                        <textarea class="is-about" name="description" placeholder="Description" id="des_val"></textarea>
                                    </div>
                                </div>
                            </div>
                            <div class="data-body-right">
                                <div class="data-block" data-field="content">
                                    <h3>YouTube iFrame</h3>
                                    <div class="form-group">
                                        <textarea class="is-about" name="content" placeholder="Insert YouTube Embed code" id="content_val"></textarea>
                                    </div>
                                </div>
                                <div class="data-block" data-field="keywords">
                                    <h3>Keywords</h3>
                                    <div class="form-group">
                                        <textarea class="is-about" name="keywords" placeholder="Keywords" id="keywords_val"></textarea>
                                    </div>
                                </div>
                                <div class="data-block" data-field="media_content">
                                    <h3>Media Content</h3>
                                    <div class="form-group">
                                        <input type="text" name="media_content" placeholder="Media Content" id="mediac_val">
                                    </div>
                                </div>
                                <div class="data-block" data-field="media_thumbnail">
                                    <h3>Media Thumbnail</h3>
                                    <div class="form-group">
                                        <input type="text" name="media_thumbnail" placeholder="Media Thumbnail" id="mediat_val">
                                    </div>
                                </div>
                            </div>
                            <div class="submit-feed">
                                <div class="form-group add-details">
                                    <button id="add_feed">Add Feed</button><span class="add-feed-loader"> loader</span>
                                    <div class="success">Successfully Added</div>
                                </div>


                                <div class="form-group update-details">
                                    <button id="update_feed">Update Feed</button>
                                    <div class="error">Error</div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        <footer class="wrapper footer-wrapper">
            <div class="container">
            </div>
        </footer>
    </main>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.9/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/functions.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase-firestore.js"></script>
    
    <script>
    var input_value = {}
    var cur_id

    function getUrlParameter(name) {
        name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
        var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
        var results = regex.exec(location.search);
        return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
    };
    // Initialize Firebase
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyD2loaJl1Hn9SjjCan6CaV9sXDFvopA1k4",
        authDomain: "dashboard-51ea4.firebaseapp.com",
        databaseURL: "https://dashboard-51ea4.firebaseio.com",
        projectId: "dashboard-51ea4",
        storageBucket: "dashboard-51ea4.appspot.com",
        messagingSenderId: "1062965330854"
    };
    firebase.initializeApp(config);
    var db = firebase.firestore();
    // Disable deprecated features
    db.settings({
        timestampsInSnapshots: true
    });


    if (getUrlParameter('id')) {
        db.collection("Yahoo_Feed").doc(getUrlParameter('id')).get().then((doc) => {
            console.log(doc.data());
            cur_id = doc.id
            $(".data-block").each(function() {
                $(this).find("p").html(doc.data()[$(this).attr('data-field')]);
                $(this).find("input, textarea").show().val(doc.data()[$(this).attr('data-field')]);
            })
            $(".data-header h2").html(doc.data().name);
            // if (doc.data().lang == "eng") {
            //     $(".back_link").attr("href", "data-list-english.html");
            // } else {
            //     $(".back_link").attr("href", "data-list-hindi.html");
            // }
        }).catch(function(error) {
            location.href = "index.html"
        });
        $(".data-block.date-field").remove();
        $(".update-details").addClass("is-show");
        $(".form-main").remove();
    } else {
        $(".data-block.date-field").show();
        $(".add-details").addClass("is-show");
    }
    var validate_flag = []
    $('#update_feed').click(function(e) {
        e.preventDefault();
        validate_flag = []

        $('#details_form input, #details_form textarea').each(function() {
            console.log($(this).val())
            if ($(this).val() == "") {
                $(this).focus();
                validate_flag.push(0)
                return false;
            } else {
                validate_flag.push(1)
            }
        });
        console.log(validate_flag);
        if (validate_flag.includes(0)) {
            return false;
        }
        $('#details_form input').each(function() {
            input_value[$(this).attr('name')] = $(this).val();
        })
        $('#details_form textarea').each(function() {
            input_value[$(this).attr('name')] = $(this).val();
        });
        db.collection("Yahoo_Feed").doc(cur_id).update(input_value).then((doc) => {
            console.log('success')
            // display success message
            $(".success").fadeIn();
        }).catch(function(error) {
            console.log(error)
            // display error message
            $(".error").fadeIn().html(error);
        });
    });

    function validate() {
        $('#details_form input, #details_form textarea').each(function() {
            if ($(this).val() == "") {
                $(this).focus();
                return false;
            }
        });
    }
    var add_feed_flag=0
    $('#add_feed').click(function(event) {
        event.preventDefault();
        
        if(add_feed_flag==0)
        {
        $(".add-feed-loader").css("display", "inline-block");
        add_feed_flag=1
        validate_flag = []
        $('#details_form input, #details_form textarea').each(function() {
            console.log($(this).val())
            if ($(this).val() == "") {
                $(this).focus();
                validate_flag.push(0)
                return false;

            } else {
                validate_flag.push(1)
            }
        });
        console.log(validate_flag);
        if (validate_flag.includes(0)) {
            return false;
        }
        $('#details_form input').each(function() {
            if ($(this).attr('name') == 'date') {
                var now = new Date;
                // now.setHours(now.getHours() - 5);
                var utc_timestamp = Date.UTC(now.getUTCFullYear(),now.getUTCMonth(), now.getUTCDate() , 
      now.getUTCHours(), now.getUTCMinutes(), now.getUTCSeconds(), now.getUTCMilliseconds());
                input_value[$(this).attr('name')] =new Date(utc_timestamp)
              
            } else {
                console.log()
                input_value[$(this).attr('name')] = $(this).val();
            }
        })
        $('#details_form textarea').each(function() {
            input_value[$(this).attr('name')] = $(this).val();
        })
        var radioValue = $("input[name='radio-group']:checked").val();
        console.log("Radio: " +radioValue);
        input_value['category'] = radioValue
        
        if(radioValue=='IPL' || radioValue=='TQ')
        {
        input_value['display_category'] = 'TQ'   
        }
        else if(radioValue=='BQ')
        {
        input_value['display_category'] = 'BQ'   
        }
        else
        {
        input_value['display_category'] = 'null'     
        }
        console.log(input_value);
       db.collection("Yahoo_Feed").doc().set(input_value).then((doc) => {
            // hid loading icon
            console.log('success');
            // display success message
            $(".success").fadeIn();
            $(".add-feed-loader").fadeOut();
        }).catch(function(error) {
            console.log(error)
            // display error message
            $(".error").fadeIn().html(error);
        });
    }
    else
    {
        $(".success").html('Entry already added. Click "Add Feed" to add more');
    }
    });
    var now = new Date();
    var day = ("0" + now.getDate()).slice(-2);
    var month = ("0" + (now.getMonth() + 1)).slice(-2);
    var today = now.getFullYear() + "-" + (month) + "-" + (day);
    $('#date').val(today);
    $(".print_btn").click(function() {
        window.print();
    })
    $(".des").click(function() {
        firebase.auth().signOut().then(function() {
            location.href = "index.html"
        }, function(error) {
            // An error happened.
        });
    })
    var radioValue;
    $("#form_btn").click(function(e){
        e.preventDefault();
        console.log($("#enterId").val());

        radioValue = $("input[name='radio-group']:checked").val();
        console.log(radioValue);
        var url;
        if(radioValue == "TQ" || radioValue == "IPL"){
            url ="www.thequint"
            console.log("thequint")

        }else if(radioValue == "HQ"){
            url ="hindi.thequint"

        }else {
            url ="bloombergquint"
        }

        $.getJSON('https://' + url + '.com/api/v1/stories/'+ $("#enterId").val(), function( data ) {
            console.log(data.story);
            console.log(data.story.headline);
            console.log(data.story.summary);

            var tags = ""
            for (var i=0;i<data.story.tags.length;i++){
                tags+=data.story.tags[i].name+","
            }
            console.log(tags);

            $("#title_val").val(data.story.headline);
            $("#link_val").val("https://" + url + ".com/"+data.story.slug);

            if(radioValue == "TQ" || radioValue == "IPL"){
                $("#des_val").val(data.story.seo['meta-description']);

            }else if(radioValue == "HQ"){
                $("#des_val").val(data.story.summary);

            }else {
                $("#des_val").val(data.story.seo['meta-description']);
            }

            // $("#des_val").val(data.story.seo['meta-description']);
            $("#keywords_val").val(tags);
            $("#mediac_val").val(data.story['hero-image-url']);
            $("#mediat_val").val(data.story['hero-image-url']);
        });
    });

    firebase.auth().onAuthStateChanged(function(user) {
        console.log(user)
    if (user) {
    // User is signed in.
    } else {
        location.href="index.html"
    // No user is signed in.
    }
    });


    </script>
</body>

</html>